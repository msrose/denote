<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: denote.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: denote.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @author Michael Rose
 * @license https://github.com/msrose/denote/blob/master/LICENSE
 * @module Denote
 */

'use strict';

var ThenCall = require('./then-call');
var coerce = require('./coerce');

var PENDING = 'pending',
  FULFILLED = 'fulfilled',
  REJECTED = 'rejected';

/**
 * Creates a new promise object.
 * @constructor
 * @since 1.0.0
 */
function Denote() {
  this._thenCalls = [];     // list of ThenCall objects (one for each call to .then)
  this._state = PENDING;    // current state of the promise
  this._resolving = false;  // keep track of whether or not .resolve has been called
  this._value = undefined;  // value of the resolved promise
  this._reason = undefined; // reason why the promise was rejected
}

/**
 * Register fulfillment and rejection handlers for a promise.
 * Non-function arguments are ignored.
 * @public
 * @since 1.0.0
 * @param {function} onFulfilled The fulfillment handler
 * @param {function} onRejected The rejection handler
 * @returns {Denote} A new Denote promise instance
 */
Denote.prototype.then = function(onFulfilled, onRejected) {
  var thenCall = new ThenCall(onFulfilled, onRejected, new Denote());
  if(this._state === FULFILLED) {
    thenCall.fulfill(this._value);
  } else if(this._state === REJECTED) {
    thenCall.reject(this._reason);
  } else {
    this._thenCalls.push(thenCall);
  }
  return thenCall.returnPromise;
};

/**
 * Resolves the promise with the given value
 * Adopts the state of the value if it is a thenable
 * Subsequent calls will be ignored
 * @public
 * @since 1.0.0
 * @param {any} value the value of the promise
 * @throws {TypeError} If the promise is resolved with itself
 * @returns {undefined}
 */
Denote.prototype.resolve = function(value) {
  if(this._state !== PENDING || this._resolving) {
    return;
  }
  if(value === this) {
    throw new TypeError();
  }
  this._resolving = true;
  var promise = this;
  var fulfill = function(fulfillValue) {
    promise._state = FULFILLED;
    promise._resolving = false;
    promise._value = fulfillValue;
    promise._thenCalls.forEach(function(thenCall) {
      thenCall.fulfill(fulfillValue);
    });
  };
  var reject = this.reject.bind(this);
  coerce(value, Denote, fulfill, reject);
};

/**
 * Rejects the promise with the given reason.
 * Subsequent calls will be ignored.
 * @public
 * @since 1.0.0
 * @param {any} reason The reason why the promise was rejected
 * @returns {undefined}
 */
Denote.prototype.reject = function(reason) {
  if(this._state !== PENDING) {
    return;
  }
  this._state = REJECTED;
  this._reason = reason;
  this._thenCalls.forEach(function(thenCall) {
    thenCall.reject(reason);
  });
};

/**
 * Registers a rejection handler with the promise.
 * Equivalent to calling promise.then(undefined, onRejected).
 * @public
 * @since 1.1.0
 * @param {function} onRejected The rejection handler
 * @returns {Denote} A new instance of a Denote promise
 */
Denote.prototype.catch = function(onRejected) {
  return this.then(undefined, onRejected);
};

/**
 * The three states of a promise
 * @private
 * @readonly
 * @enum {string}
 */
Denote.states = {
  /** The promise is has not been resolved or rejected (default state) */
  PENDING: PENDING,
  /** The promise is has been resolved */
  FULFILLED: FULFILLED,
  /** The promise is has not been rejected */
  REJECTED: REJECTED
};

/**
 * The Denote constructor
 */
module.exports = Denote;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-coerce.html">coerce</a></li><li><a href="module-Denote.html">Denote</a></li><li><a href="module-denote_.html">denote</a></li><li><a href="module-ThenCall.html">ThenCall</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Classes</h3><ul><li><a href="module-Denote-Denote.html">Denote</a></li><li><a href="module-ThenCall-ThenCall.html">ThenCall</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Sun Mar 06 2016 23:49:20 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
